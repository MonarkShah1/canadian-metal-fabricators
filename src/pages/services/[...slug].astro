---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import Navbar from '../../components/Navbar.astro';
import Footer from '../../components/Footer.astro';
import Button from '../../components/ui/Button.astro';

// 1. Generate a new path for every collection entry
export async function getStaticPaths() {
  const serviceEntries = await getCollection('services');
  return serviceEntries.map(entry => ({
    params: { slug: entry.slug }, props: { entry },
  }));
}

// 2. Get the entry for the current page
const { entry } = Astro.props;
const { Content } = await entry.render();
---

<Layout title={entry.data.title} description={entry.data.description}>
  <Navbar />
  
  <main class="pt-20">
    <!-- Service Header -->
    <section class="bg-gray-900 text-white py-20 px-6 md:px-20 relative overflow-hidden">
        <div class="absolute inset-0 z-0 opacity-40">
            {entry.data.heroImage && <img src={entry.data.heroImage} alt={`${entry.data.title} - CMF Service`} class="w-full h-full object-cover" />}
        </div>
        <div class="relative z-10 max-w-4xl">
            <h1 class="font-montserrat font-bold text-4xl md:text-6xl mb-6">{entry.data.title}</h1>
            <p class="font-poppins text-xl opacity-90 mb-8 max-w-2xl">{entry.data.description}</p>
            <Button href="#contact" variant="primary">Get a Quote</Button>
        </div>
    </section>

    <!-- Content Body -->
    <section class="py-16 px-6 md:px-20 container mx-auto grid grid-cols-1 md:grid-cols-3 gap-12">
        
        <!-- Main Article -->
        <article class="md:col-span-2 prose prose-lg prose-blue max-w-none font-poppins text-gray-700">
            <Content />
        </article>

        <!-- Sidebar / Features -->
        <aside class="space-y-8">
            <div class="bg-gray-50 p-8 rounded-2xl border border-gray-100 sticky top-24">
                <h3 class="font-montserrat font-bold text-xl mb-4">Key Capabilities</h3>
                <ul class="space-y-3 mb-8">
                    {entry.data.features.map(feature => (
                        <li class="flex items-center gap-3 text-gray-700 font-poppins">
                            <svg class="w-5 h-5 text-primary flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                            {feature}
                        </li>
                    ))}
                </ul>

                <div class="bg-primary/5 p-6 rounded-xl">
                    <h4 class="font-bold text-primary mb-2">Need a Quote?</h4>
                    <p class="text-sm text-gray-600 mb-4">Upload your DXF/STEP files for a rapid response.</p>
                    <Button href="#contact" variant="primary" class="w-full text-center">Start Quote</Button>
                </div>
            </div>
        </aside>

    </section>
  </main>

  <Footer />
</Layout>
